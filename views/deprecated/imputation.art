<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Test</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js" integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script><script src="jquery-3.6.0.min.js"></script>
    </head>
    <body>
      <div class="container-sm">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <% if (viewStatus ==="expert") { %>
              <li class="breadcrumb-item text-primary" id="noExpert">No Expert</li>
              <li class="breadcrumb-item text-muted" id="expert">Expert</li>
            <% }else{ %>
              <li class="breadcrumb-item text-muted" id="noExpert">No Expert</li>
              <li class="breadcrumb-item text-primary" id="expert">Expert</li>
            <%} %>
          </ol>
        </nav>

        
        <form action="/imputation" method="post">
          
            <label for="db-list" class="form-label fs-5">Select a database: </label>
            <select class="form-select mb-3 form-control" aria-label="Default select example" name="db_selected">
              <% Object.entries(db_list).forEach(function(entry){
                const [key, value] = entry%>
                <option value="<%- key %>" name ="<%- key %>"><%- key %></option>
              <% }) %> 
            </select>

            <button type="submit" class="btn btn-primary mb-3">Submit</button>
          
        </form>

        <% if (typeof db_infos !== 'undefined')  { %>

          <form action="/imputation/result" method="post">
            <div class="card mb-5"  id="detail" >
              <div class="card-body">
                <h5 class="card-title">Database Infos</h5>
                  <% Object.entries(db_infos).forEach(function(entry){
                    const [key, value] = entry%>
                    <div class="row">
                      <div class="col text-uppercase fw-bold float-end " value="<%- key %>" >
                        <%- key %>
                      </div>
                      <div class="col" value="<%- value %>">
                          <%- value %>
                        </div>
                    </div>
                  <% }) %> 
              </div>
            </div>
          
          
            <% if (typeof db_schema !== 'undefined') { %>
              <p class="fs-5">Select attributes to complete: </p>

              <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                  <% Object.entries(db_schema).forEach(([dim_name, dim_detail], index) =>{
                    if (index == 0) { %>
                  <button class="nav-link active text-uppercase" id="nav-<%- dim_name%>-tab" data-bs-toggle="tab" data-bs-target="#nav-<%- dim_name%>" type="button" role="tab" aria-controls="#nav-<%- dim_name%>" aria-selected="true"><%- dim_name %></button>
                  <% } else { %>
                  <button class="nav-link text-uppercase" id="nav-<%- dim_name%>-tab" data-bs-toggle="tab" data-bs-target="#nav-<%- dim_name%>" type="button" role="tab" aria-controls="#nav-<%- dim_name%>" aria-selected="false"><%- dim_name %></button>
                  <% } })%>
                </div>
                
              </nav>


              <div class="overflow-scroll mb-3" style="height:400px ;">
              <div class="tab-content" id="nav-tabContent">

              <% Object.entries(db_schema).forEach(([dim_name, dim_detail], index) =>{
                  if (index == 0) { %>
                    <div class="tab-pane fade show active" id="nav-<%- dim_name%>" role="tabpanel" aria-labelledby="nav-<%- dim_name%>-tab" tabindex="0">
                  <% } else { %>
                    <div class="tab-pane fade" id="nav-<%- dim_name%>" role="tabpanel" aria-labelledby="nav-<%- dim_name%>-tab" tabindex="0">
                  <% } %>

                  <table class="table table-striped table-hover table-responsive">
                  <tr>
                    <th scope="col" style="width: 15%">Dimension</th>
                    <td scope="row" class = "text-uppercase fw-bold"><%- dim_name %></td>
                  </tr>
                  <tr>
                    <% Object.entries(dim_detail).forEach(function(property){
                      const [proper_name, proper_detail] = property%>
                      <% if (proper_name == "Hierarchy" && proper_detail != "None") { %>
                          <% Object.entries(proper_detail).forEach(([hie_name, hie_detail], index) =>{%>
                            <tr name="hierarchy" style="display: none">
                              <th scope="col" >Hierarchy <%- index+1 %></th>
                              <td><%- hie_name%></td>
                            </tr>

                            <% Object.entries(hie_detail).forEach(function(hie_property){
                              const [hie_key, hie_value] = hie_property%>
                              <% if (hie_key == "Weak Attributes") { %>
                                <tr name="hieWeakAttributes" style="display: none">
                                  <th scope="col">- <%- hie_key%></th>
                                  <td>
                                    <% Object.entries(hie_value).forEach(function(weak){
                                      const [key, weak_attri] = weak%>
                                      <%- key +": " + weak_attri%><br>
                                    <% }) %>
                                  </td>
                                </tr>
                              <% } else {%>
                                <tr name="hieParameter" style="display: none">
                                  <th scope="col">- <%- hie_key%></th>
                                  <td><%- hie_value%></td>
                                </tr>
                              <% } %>
                            <% }) %>

                          <% }) %>
                      <% } else if (proper_name == "Weak Attributes" && proper_detail != "None") { %>
                        <tr name="weakAttributes" style="display: none">
                          <th scope="col"><%- proper_name%></th>
                          <td>
                            <% Object.entries(proper_detail).forEach(function(weak){
                              const [key, weak_attri] = weak%>
                              <%- key +": " + weak_attri%><br>
                              <% }) %>
                          </td>
                        </tr>
                      
                      <% } else if (proper_name == "Missing") { %>
                        <tr name="missing">
                          <th scope="col"><%- proper_name%> Attributes </br>(Missing Number)</th>
                          <td>
                            <% Object.entries(proper_detail).forEach(function(missing){
                              const [attri, nb] = missing%>
                              <div class="form-check">
                                <%if (nb === 0) {%>
                                    <input class="form-check-input" type="checkbox" value="<%- attri%>" id="flexCheckDefault<%- attri%>" name="colSelected" disabled>
                                    <label class="form-check-label" for="flexCheckDefault<%- attri%>" disabled>
                                      <%- attri +": " + nb%>
                                    </label>
                                <% } else { %> 
                                    <input class="form-check-input" type="checkbox" value="<%- dim_name%>-<%- attri%>-<%- nb%>" id="flexCheckDefault<%- attri%>" name="colSelected">
                                    <label class="form-check-label" for="flexCheckDefault<%- attri%>">
                                      <%- attri +": " + nb%>
                                    </label>
                                <% } %>
                              </div>
                            <% }) %>
                          </td>
                        </tr>
                      
                      <% } else if  (proper_name == "Total Number") {%>
                        <tr name="total">
                          <th scope="col">Total Record Number</th>
                          <td><%- proper_detail%></td>
                        </tr>
                      <% } else {%>
                        <tr name="attributes" style="display: none">
                          <th scope="col"><%- proper_name%></th>
                          <td><%- proper_detail%></td>
                        </tr>
                      
                      <% } %>

                    <% }) %>
                  </tr>
                  </table>
                  </div>
                <% }) %>
              </div>
              </div>
              <% } %>

              <!-- Button trigger modal -->
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" id = "next">
                Complete
              </button>

              <!-- Modal -->
              <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="test">
                        <p >123...</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                      <button type="submit" class="btn btn-primary">Yes</button>
                    </div>
                  </div>
                </div>
              </div>
            <% } %>

          </form>
              
      </div>

      <script>
        $(document).ready(function(){
          $("#next").click(function(){
            var allVals = [];
            $("#test").html("");
            $("#test").append("<p>The missing values in the following attributes will be completed :</p>"+ 
            '<table class="table" style = "width: 80%">' +
                          '<thead>' +
                            '<tr>' +
                              ' <th scope="col" style="width:10%"></th>'+
                              '<th scope="col" style="width:45%">Dimension</th>' +
                              '<th scope="col" style="width:45%">Attributes</th>'+
                            '</tr>' +
                          '</thead>')
            nb = 1;
            $('input:checkbox[name=colSelected]:checked').each(function(){
              allVals.push($(this).val());
              $("#test").append('<table class="table" style="width: 80%">' +
                                  '<tr><th style="width:10%">'+nb+ '</th>'+
                                  '<td style="width:45%">'+$(this).val().split("-")[0]+"</td>"+"<td class='width:50%'>"+$(this).val().split("-")[1]+"</td></tr>"+
                                '</table>')
              nb += 1;
            })
            $("#test").append('</tbody>')
            $("#test").append('<p class="fs-5"></p>')
            $("#test").append('<select class="form-select form-select-md mb-3" aria-label=".form-select-lg example" name="algo">' +
                                '<option value="hie">Hierarchical imputation</option>' + 
                                '<option value="olapknn">OLAPKNN imputation</option>' +
                                '<option value="hieOlapknn">Hie-OLAPKNN</option>'+
                              '</select>')
            // $("#test").html("<p>"+allVals+"</p>")
          })

          // no expert version
          $("#noExpert").click(function(){
            if($("#noExpert").hasClass("text-primary")){
              $("#noExpert").toggleClass("text-primary")
              $("#noExpert").addClass("text-muted")
              $("#expert").removeClass("text-muted")
              $("#expert").addClass("text-primary")
              $("tr[name*='hie']").hide()
              $("tr[name*='ttributes']").hide()
            }
          })

          // exper version
          $("#expert").click(function(){
            if($("#expert").hasClass("text-primary")){
              $("#expert").removeClass("text-primary")
              $("#expert").addClass("text-muted")
              $("#noExpert").removeClass("text-muted")
              $("#noExpert").addClass("text-primary")
              $("tr[name*='hie']").show()
              $("tr[name*='ttributes']").show()
            }
          })


          
        })


      </script>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    </body>
</html>